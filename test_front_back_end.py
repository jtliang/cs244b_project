from message import Message
import socket
import struct
import time

def ip2int(addr):                                                               
  return struct.unpack("!I", socket.inet_aton(addr))[0]                       

def int2ip(addr):                                                               
  return socket.inet_ntoa(struct.pack("!I", addr)) 

random1 = "AFE39EC8D223A28ECE53247444A71E073EEF7DD3464BE8A052030C602C7AA5255183C31298C6ADFB49F9BEAAAABF24D8104AA501AF3679C340ECFEB4F3C0AAC70019058336A01AF113A57D847D61DA5D0433963E96BA17571D41A1A07CEA4C631DF56FF21D87C5CDF9BE5081B12DA2C51E03BD00FDD10D3694421019591145A3"
random2 = "069E3255A48AF84B35C2CA67A1ECC06453820ED0B1D84850A060476C90CAC9F1F3D57AB9016E52BE02EC5117B245C694DC852FC41F44105C9AE7A0BFD6C0F52D6D5E6E7CD6805CDE1E67CC80939B82E7DD12C689A2FD9B35C3A3F92329A4813AECFD555CB17FC160E476BE28DCF76367CF48FDA9231DDAAD8FA3C384EEA54261"
random3 = "EFE95FEE1521B850792088ADA6BA26FE48990C7E785D8A457214F59308523EC678FAF0FAB7DBE2E33C8FD9CE9F26A3C7CC440F8F9CF2EBF882C09BF9A8F97BA39D928F76029BBABCCA80BF7B6EA0DC8FDF474F73695E3CCFCCC89F3FAEB6520058D3D4FEA09019D6AF863BC7B4F07EF2AAEAA50B8E37E8A7873125C514EC984B"
random4 = "30C437B38A5A561C98D031BA825052F38F7ED1000E859E24C523F9CC73DD747BD4B9E9221C94A7888F53B8D33CFD9B5762F12E01800EF630B9C2A6148831A2977BCA356B6B956B05DF8E77FF4260562ACF93494E50B0ADECD2A2BBD5306E717B914392E2B163CCCFE28118A1D2C5128AAC7C3D27DF8DDE6D5B498B6072AC7902"
random5 = "1C056024AD9F9C24A7BD820F977F7ABDF96CC595D3EBC9E17F822C40C60FE8A4DDDFAC2342E05AC45E901CC70600CE871D92E17749E643868B946F734BB58B9AA8FB5AE94C8C8F5EB0373CC88D3619B871A925EA3CA5299544A507CADC85C59A3291E629E91B401DB5D7802CFA8049708C488B83084E8AB000E6FC2972CE10A2"
random6 = "5254E7BE841ADDAB60411E43B0ED0FB113BA1788892D0D4F7E25F45D0D0BD4E631FF7E1B332B4139F6ECF0E8BF80E99AA49E7A5655B42EC6621C40E2CB46A3C33516CFCFD13D885D4603C11AC3054748B1651806AE9928ADB773D0BDD90CFA09E51463756F4A88430490F8E5C3EA19C1F95D25D832151C99D682B50C8FFBFA18"
random7 = "954F603B3C63D3D8AE8DA7181077A2DCE1C02A4B54AAF706FEC8645C9213689CCAB0F026E1795E023E33F3B031960F4D84820D8B2F21E1DC220E69E4635497384010B0C27C19D4FA88E2A2DE719EA01328FB45156E4B60AA8B7A1E7C5C010C84B023D3E83C84B5D96BA537C9D781AAE107949BCE3BC9359338BFC82F7E25DDB6"
random8 = "5AD096BD2E96DF55C1C35E27A21721E264405E3AE5B56AD5667A32000DCEEC6D0360AD6780ACEE55B0EAE2F4B00402DF728652BC3081D21376038AF4703F043CC46E08BE662F271D7306E4893F93D880BAE11E3460C240B4DF48C435D42204A138E51C34C5DE88F5EEF2932435D8255FFC3E70421541B30432BAC97086625B7D"
random9 = "7EBCBC40B3D90683C0E0FEAF7B7541D4CBB8183463CE4D0D092B1DB7DCAFB90CAA00FD4FAAC0B69671F3EA2FD190014AD5E4AA900FCBCEB3BC5D66515A52362FF86B18785886E85030CDA2DE0CE1AEF82A6EF9B2358ECCDFCA8E386AC7EE1E673168AE7FC96E2ED673AE24369147522215FDD2AEA288E9B1901BCB4DF58F6793"
random10 = "C5256E67DD8649DB33D97C5D30B5B4A4901E9FB2EFE0B94974EE61861D2C111AFB47CE0BCDB42182D85378EA40440042B2BB2A211C4BC65E5DAD5A779D9DC96E937FA6081DF180DC38C57DB3AECE17B4EE5B84ED2E81A9F4D72821C07E69AEB4DF7F95EBC7BDA956E9155D459F661C141E7DC1259BC28520ECC6D7C3B26E166A"

random256 = [random1, random2, random3, random4, random5, random6, random7, random8, random9, random10]
key_num = 0
num_entries = 4000

ip = '35.227.183.171'
port = 9999

total_time = 0
for i in range(num_entries):
  if i % 100 == 0:
    print("Processed %d elements" % i)
  try:
    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    s.connect((ip, 9999))
    put_message = Message(0, Message.PUT, ip2int(ip), 9999, len("key" + str(key_num)), "key" + str(key_num), random256[i % len(random256)])
    message = put_message.to_buff()
    start_time = time.time()
    s.sendall(message)
    receive_data = s.recv(Message.MAX_SIZE)
    total_time += time.time() - start_time
    reply_message = Message.from_data(receive_data)
    key_num += 1
  finally:
    s.close()

print("Took %f seconds" % (total_time))
